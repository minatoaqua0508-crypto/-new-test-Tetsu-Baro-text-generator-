function webATMPluginDetect(t){var n="41";switch(navigator.appName){case"Microsoft Internet Explorer":n="11"}"11"===n?jQuery(document.body).append('<object id="Xcsp" classid="clsid:A6132015-5796-48B5-B776-16D009021D81"></object>'):jQuery(document.body).append(jQuery("<embed/>",{id:"Xcsp",width:"0",height:"0",classid:"clsid:A6132015-5796-48B5-B776-16D009021D81",type:"application/FCB-WebATM-plugin"}));document.getElementById("Xcsp");try{Xcsp.DisconnectCard(),Xcsp.DisconnectDriver()}catch(a){t("https://eatm.firstbank.com.tw/lio1000s8")}}$(document).ready(function(){$.topnav.init(),$.getCounter(),$.showMsgBox()}),function(t){function n(){"zh-TW"===Body.attr("lang")&&t.topnav.guestTool(),t.topnav.langToggle()}function a(){t.topnav.ajax({url:"/account/tools/",dataType:"html",data:t.param({t:"t",f:"s_guesttools"})}).done(function(n){t("#topnav").append(n),t("#topnav").on("click","#login-btn",function(n){return t.NDCLogin.setVirtualHost(t(this).attr("href")),t.NDCLogin.setFBLoginAvailable(t(this).data("fb-switch")),t.NDCLogin.setGoogleLoginAvailable(t(this).data("google-switch")),t.NDCLogin.setLineLoginAvailable(t(this).data("line-switch")),t.util.addScript("validate","/templates/js/libs/jquery-validation/dist/jquery.validate.min.js",o),!1}),t(n).find("#cart-badge").length>0&&t.topnav.cart.init(),t("#manager-login-js").length&&t.util.addWindowOnLoad(function(){t.topnav.addManagerLogin()})})}function o(){t("#modal-login").length?t("#modal-login").NDCLogin():t.tplLoader.load("login.html",function(n){n=n.format(t("#logo").html(),t("#logo").text()),t(n).appendTo("body").NDCLogin(),fbLoginBtn=t("#fb-login-btn"),googleLoginBtn=t("#google-login-btn"),lineLoginBtn=t("#line-login-btn"),fbLoginBtn.data("available")||fbLoginBtn.hide(),googleLoginBtn.data("available")||googleLoginBtn.hide(),lineLoginBtn.data("available")||lineLoginBtn.hide()})}var e=function(){function n(t){"undefined"==typeof t?0===parseInt(c.text())?c.hide():c.show():0===parseInt(t)?c.hide():c.text(t).show()}function a(){t.ajax({type:"POST",url:"/shopping/mycart/",dataType:"json",async:!1,success:function(t){o(t)}})}function o(a){var o=t("#dropdown-checkout"),e=o.find(".totalprice"),c=o.children(".start-checkout"),r='<tr class="text-center"><td>目前沒有購買產品</td></tr>',s='<tr>                <th><a href="/{0}">{1}</a></th>                <td>{2}</td>                <td> &times;{3}</td>                <td class="price">{4}</td>                <td class="text-right"><a class="trash-btn" id="{5}" title="從購物車中移除本商品" data-toggle="tooltip" data-container="body"></a></td>                </tr>',l='<a href="https://{0}/shopping/cart/" class="start-checkout btn btn-block btn-cart"><i class="fa fa-shopping-cart fa-lg"></i>開始結帳</a>';a.num>0?(i.html(""),t.each(a.item,function(n,a){var o=a.price*a.quantity;t(s.format(a.filename,a.name,a.spec,a.quantity,o,a.id)).appendTo(i)}),c.length||o.append(l.format(window.location.host)),e.text(a.subtotal),n(a.num)):(i.html(r),c.length&&c.remove(),e.text("0"),n(0))}function e(n){var o={t:"t",f:"d_delitems",f_d_invid:n.attr("id")};t.ajax({type:"POST",url:window.location.pathname,dataType:"json",data:t.param(o),success:function(n){"success"==n.state?(a(),t.productSpec.refreshModels()):e7notice(n.error,"error")}})}var i,c;return{init:function(){i=t("#check-table"),c=t("#cart-badge"),i.on("click",".trash-btn",function(){return t(this).tooltip("destroy"),e(t(this)),!1}),t.util.addWindowOnLoad(function(){0!==parseInt(c.text())&&t(".cart .dropdown-toggle").dropdown("toggle")}),n(),a()}}}();t.extend(t.topnav,{init:n,guestTool:a,openLogin:o,cart:e})}(jQuery),function(t){t.getCounter=function(){var n={t:"t",f:"d_counter"};t.ajax({type:"POST",url:window.location.pathname,dataType:"json",data:t.param(n),async:!1,success:function(n){t("#counter span").html(n.visitors)}})}}(jQuery),function(t){t.fn.payway=function(){function n(n){o.button("loading");var a={t:"t",f:"s_getPayment",f_s_custno:e.data("custno"),f_s_payment:n};t.ajax({type:"POST",url:"/shopping/payment/",dataType:"json",data:t.param(a),async:!1,success:function(a){"success"==a.status?(o.button("complete"),"14"==n?e.attr("method","GET"):e.attr("method","POST"),e.attr("action",a.payment.paypage),i.empty(),t.each(a.payment.parames,function(n,a){t("<input/>").attr({type:"hidden",name:n,value:a}).appendTo(i)})):alert(a.message)},timeout:1e4})}var a,o=this.find(".btn-cart"),e=this.find("form"),i=this.find(".hidden");this.find(".form-overseas-payway").length?(n(e.find("input[name='f_s_payment']").val()),e.find("input[name='f_s_payment']").remove()):(this.children().on("change","input[name='f_s_payment']",function(o){if(n(t(this).val()),"4"===t(this).val()){var i=e.parent(".form-payway");a=i.prev(".alert"),webATMPluginDetect(function(n){a.length||(a=t("<div/>",{"class":"alert alert-warning fade in",role:"alert"}).insertBefore(i)),a.html('<i class="fa fa-exclamation-triangle"></i>                            你尚未安裝由第一銀行提供的 WebATM 晶片金融卡安控元件，請您先執行 <a href="{0}" target="_blank" class="alert-link">安裝晶片金融卡安控元件</a>                            <br>※ 本WebATM尚不支援Firefox、Chrome瀏覽器'.format(n,"https://eatm.firstbank.com.tw/lio1000s1?CtlSeqNo=20&naLoginSource=&naPushBranchId=")).alert()})}else"undefined"!=typeof a&&a.alert("close")}),e.submit(function(){return 0===e.find("input[name='f_s_payment']:checked").length?(alert("請選擇付款方式"),!1):void e.find("input[name='f_s_payment']").remove()}))}}(jQuery),function(t){function n(n){t.data(n,"elem",{blockLogin:t(n).find(".block-login"),blockForgot:t(n).find(".block-forgot"),subblockLogin:t(n).find(".subblock-login"),subblockSignup:t(n).find(".subblock-signup"),forgetBtn:t(n).find(".link-forgot"),cancelBtn:t(n).find(".cancel"),linkSignupBtn:t(n).find(".link-signup"),backLoginBtn:t(n).find(".back-login"),inputAccount:t(n).find('input[name="account"]'),inputPasswd:t(n).find('input[name="passwd"]'),inputCaptcha:t(n).find('input[name="captcha"]'),imgCaptcha:t(n).find("img#captcha"),facebookLoignBtn:t(n).find(".fb-login-btn"),googleLoginBtn:t(n).find(".google-login-btn"),lineLoignBtn:t(n).find(".line-login-btn"),form:t(n).find("form"),isForgot:!1,isSignup:!1});var c=t.data(n,"elem");c.form.attr("action",e+a.login+o),c.forgetBtn.bind("click",function(){c.isForgot=!0,c.form.attr("action",e+a.forgot+o),c.blockLogin.slideUp("fast"),c.blockForgot.slideDown("fast")}),c.cancelBtn.bind("click",function(){c.isForgot=!1,c.form.attr("action",e+a.login+o),c.blockLogin.slideDown("fast"),c.blockForgot.slideUp("fast")}),c.linkSignupBtn.bind("click",function(){c.isSignup=!0,c.form.attr("action",e+a.singup+o),c.subblockLogin.slideUp("fast"),c.subblockSignup.slideDown("fast")}),c.backLoginBtn.bind("click",function(){c.isSignup=!1,c.form.attr("action",e+a.login+o),c.subblockLogin.slideDown("fast"),c.subblockSignup.slideUp("fast")}),c.imgCaptcha.bind("click",function(){var n=new Date;t(this).attr("src","/captcha.php?"+n.getMilliseconds())}),c.form.validate({rules:{account:{required:!0,email:!0},passwd:{minlength:6,required:function(){return!c.isForgot}},captcha:{required:function(){return c.isForgot}},passwdagain:{required:function(){return c.isSignup},equalTo:"#passwd"},agree:{required:function(){return c.isSignup}}},messages:{account:{required:"請輸入 email",email:"請輸入正確的 email 格式"},passwd:{minlength:"請輸入6個以上的英數字元",required:"請輸入密碼"},captcha:{required:"請輸入驗證碼"},passwdagain:{required:"請再次輸入密碼",equalTo:"您再次輸入的密碼不相符"},agree:{required:"您必須同意服務條款"}},highlight:function(n,a,o){t(n).parents(".form-group").addClass("has-error")},unhighlight:function(n,a,o){t(n).parents(".form-group").removeClass("has-error"),t(n).next(".help-block").remove()},errorClass:"error",errorPlacement:function(n,a){var o=t(a).parents(".form-group").children(".help-block");o.length||(o=t("<p/>",{"class":"help-block"}).appendTo(a.parents(".form-group"))),o.text(n.text())},submitHandler:function(n){t(n).find('button[type="submit"]').button("loading"),n.submit()}}),c.facebookLoignBtn.data("available",r),c.facebookLoignBtn.bind("click",function(){var n={f:"s_getfbloginUrl",bagcode:i,redirect:window.location.pathname};return t.ajax({type:"POST",url:"/account/",dataType:"json",data:t.param(n),beforeSend:function(n){t(".fb-login-btn").attr("disabled",!0).text("登入中...")},success:function(n){"success"==n.status?window.location.href=n.url:(t(".fb-login-btn").attr("disabled",!1).text("以 Facebook 登入"),e7notice(n.messages,"error"))}}),!1}),c.googleLoginBtn.data("available",s),c.googleLoginBtn.bind("click",function(){var n={f:"s_getgoogleloginUrl",bagcode:i,redirect:window.location.pathname};return t.ajax({type:"POST",url:"/account/",dataType:"json",data:t.param(n),beforeSend:function(n){t(".google-login-btn").attr("disabled",!0).text("登入中...")},success:function(n){"success"==n.status?window.location.href=n.url:(t(".google-login-btn").attr("disabled",!1).text("以 Google 登入"),e7notice(n.messages,"error"))}}),!1}),c.lineLoignBtn.data("available",l),c.lineLoignBtn.bind("click",function(){var n={f:"s_getlineloginUrl",bagcode:i,redirect:window.location.pathname};return t.ajax({type:"POST",url:"/account/",dataType:"json",data:t.param(n),success:function(t){"success"==t.status?window.location.href=t.url:e7notice(t.messages,"error")}}),!1})}var a={login:"/account/login/auth/",forgot:"/account/forget/",singup:"/account/singup/"},o="",e="",i="",c="",r=!1,s=!1,l=!1;t.NDCLogin={setVirtualHost:function(t){var n=/(https?\:\/\/|\/\/)?[^\/\s]+\.iyp\.tw/i;n.test(t)&&(e=n.exec(t)[0]||"")},setValiCode:function(t){c="&code="+t,i=t},setFBLoginAvailable:function(t){r=1===t||!1},setGoogleLoginAvailable:function(t){s=1===t||!1},setLineLoginAvailable:function(t){l=1===t||!1}},t.fn.NDCLogin=function(){var a={};Body.hasClass("login")&&(a={keyboard:!0,backdrop:"static"}),this.modal(a),o="/account/login/"!==window.location.pathname?"?redirect="+e+window.location.pathname+c:"?redirect=/account/order/","undefined"==typeof t.data(this[0],"elem")&&n(this[0])}}(jQuery);